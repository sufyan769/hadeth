
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>أحاديث حسب التصنيف</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Cairo', sans-serif;
        background-color: #FDF6E3;
      }
      .simpson-border {
        border: 3px solid black;
        box-shadow: 4px 4px 0 #000;
        border-radius: 0.75rem;
        transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
      }
      .simpson-border:hover {
          transform: translate(-2px, -2px);
          box-shadow: 6px 6px 0 #000;
      }
      .simpson-button {
        border: 3px solid black;
        box-shadow: 4px 4px 0 #000;
        transition: all 0.1s ease-in-out;
        font-weight: 700;
      }
      .simpson-button:active {
        transform: translate(4px, 4px);
        box-shadow: none;
      }
       .animate-spin {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      .hadith-card {
        background-color: #FFFBF2;
      }
    </style>
</head>
<body class="text-stone-900">
    <div class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black text-stone-800">
                أحاديث في: <span id="category-name-span" class="text-amber-700"></span>
            </h1>
            <a href="./index.html" class="simpson-button px-5 py-2 bg-stone-200 text-stone-800 font-semibold rounded-lg hover:bg-stone-300">
                &rarr; رجوع
            </a>
        </div>
        
        <div id="results-container">
             <!-- Results will be injected here -->
        </div>
    </div>

    <div id="fab-container" class="fixed bottom-4 right-4 flex items-center gap-3 z-50">
      <a href="./index.html" class="simpson-button bg-stone-700 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-stone-800" aria-label="العودة" title="العودة">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
      <button id="font-size-toggle-btn" class="simpson-button bg-amber-500 text-black w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl font-black hover:bg-amber-600" aria-label="تغيير حجم الخط" title="تغيير حجم الخط">
          A+
      </button>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIG & CONSTANTS ---
    const FONT_SIZES = [16, 18, 20, 24];
    const LS_FONT_KEY = 'hadithAppFontSize';
    
    // --- DOM ELEMENTS ---
    const categoryNameSpan = document.getElementById("category-name-span");
    const resultsContainer = document.getElementById("results-container");
    const fontSizeToggleBtn = document.getElementById('font-size-toggle-btn');
    const fabContainer = document.getElementById('fab-container');

    // --- HELPERS ---
    const sanitizeHTML = (str) => str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    
    const showLoader = () => {
        resultsContainer.innerHTML = `
          <div class="flex justify-center items-center p-8">
            <div class="w-12 h-12 border-4 border-amber-500 border-t-transparent rounded-full animate-spin"></div>
          </div>`;
    };

    // --- FONT SIZE CONTROL ---
    const applyFontSize = (size) => {
        document.documentElement.style.fontSize = `${size}px`;
        localStorage.setItem(LS_FONT_KEY, size);
    };
    const initFontSizeControl = () => {
        const savedSize = localStorage.getItem(LS_FONT_KEY);
        if (savedSize) applyFontSize(parseInt(savedSize, 10));

        fontSizeToggleBtn.addEventListener('click', () => {
            const currentSize = parseInt(localStorage.getItem(LS_FONT_KEY) || FONT_SIZES[0], 10);
            const currentIndex = FONT_SIZES.indexOf(currentSize) !== -1 ? FONT_SIZES.indexOf(currentSize) : 0;
            const nextIndex = (currentIndex + 1) % FONT_SIZES.length;
            applyFontSize(FONT_SIZES[nextIndex]);
        });
    };
    
    // --- DRAGGABLE FAB ---
    const initDraggable = (element) => {
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      element.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
          if (e.target.closest('button, a')) return;
          e.preventDefault();
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
          e.preventDefault();
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          element.style.top = (element.offsetTop - pos2) + "px";
          element.style.left = (element.offsetLeft - pos1) + "px";
          element.style.bottom = 'auto';
          element.style.right = 'auto';
      }

      function closeDragElement() {
          document.onmouseup = null;
          document.onmousemove = null;
      }
    };

    // --- CATEGORY FETCH LOGIC ---
    const fetchCategory = async () => {
        const params = new URLSearchParams(window.location.search);
        const category = params.get("q");

        if (!category) {
            categoryNameSpan.innerText = "لم يتم تحديد تصنيف";
            resultsContainer.innerHTML = '';
            return;
        }

        categoryNameSpan.innerText = sanitizeHTML(category);
        showLoader();

        const apiUrl = `https://g85b062bd5c6cb1-fatwaproject.adb.me-dubai-1.oraclecloudapps.com/ords/SUFEAN/hadith/category/${encodeURIComponent(category)}`;

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            
            if (!data.items || data.items.length === 0) {
                resultsContainer.innerHTML = `<div class="text-center py-10 px-4 hadith-card simpson-border"><p class="text-stone-600">لا توجد نتائج في هذا التصنيف.</p></div>`;
            } else {
                const idKey = data.items[0].hasOwnProperty('id') ? 'id' : 'hadeeth_id';
                const resultsHTML = data.items.map(h => `
                    <a href="./details.html?id=${h[idKey]}" class="block hadith-card p-5 simpson-border">
                        <p class="text-stone-800 mb-2 text-lg leading-relaxed">${h.text}</p>
                        <div class="text-sm text-stone-600 font-bold">
                            <span>${h.hukm || ''}</span>
                        </div>
                    </a>
                `).join('');
                resultsContainer.innerHTML = `<div class="space-y-6">${resultsHTML}</div>`;
            }
        } catch (err) {
            console.error("Failed to fetch category:", err);
            resultsContainer.innerHTML = `<div class="text-center py-10 px-4 hadith-card simpson-border"><p class="text-red-500">حدث خطأ أثناء تحميل البيانات.</p></div>`;
        }
    };

    // --- INITIALIZATION ---
    initFontSizeControl();
    initDraggable(fabContainer);
    fetchCategory();
});
</script>

</body>
</html>
