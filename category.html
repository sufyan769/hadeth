
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>أحاديث حسب التصنيف</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Amiri', serif;
        background-color: #f8f9fa;
        color: #202122;
      }
      .main-container {
        max-width: 1000px;
        margin: 0 auto;
        background-color: #ffffff;
        border-left: 1px solid #a7d7f9;
        border-right: 1px solid #a7d7f9;
        min-height: 100vh;
      }
      h1, h2, h3 {
        font-family: 'Cairo', sans-serif;
        border-bottom: 1px solid #a2a9b1;
        padding-bottom: 0.25em;
        margin-bottom: 0.5em;
      }
      a {
        color: #3366cc;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      .result-item {
        padding: 0.75rem 0;
        border-bottom: 1px solid #eaecf0;
      }
      .result-item:last-child {
        border-bottom: none;
      }
      .result-item p {
        font-size: 1.1rem;
        line-height: 1.7;
      }
      .footer {
        font-family: 'Cairo', sans-serif;
        font-size: 0.8rem;
        color: #54595d;
      }
      .animate-spin {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
</head>
<body class="text-stone-900">
    <div class="main-container p-4 md:p-8">
        <header id="main-header" class="mb-4">
            <a href="./index.html">&larr; العودة إلى البحث</a>
        </header>
        
        <h1 class="text-3xl font-bold">
            تصنيف: <span id="category-name-span" class="text-black"></span>
        </h1>
        
        <main id="results-container">
             <!-- Results will be injected here -->
        </main>

        <footer class="footer mt-12 py-4 border-t border-gray-200 text-center">
            <button id="font-size-toggle-btn" class="hover:underline">تغيير حجم الخط</button>
        </footer>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIG & CONSTANTS ---
    const FONT_SIZES = [16, 18, 20, 24];
    const LS_FONT_KEY = 'hadithAppFontSize';
    const ORDS_API_CATEGORY_BASE_URL = "https://g85b062bd5c6cb1-fatwaproject.adb.me-dubai-1.oraclecloudapps.com/ords/SUFEAN/hadith/categories";

    // --- DOM ELEMENTS ---
    const categoryNameSpan = document.getElementById("category-name-span");
    const resultsContainer = document.getElementById("results-container");
    const fontSizeToggleBtn = document.getElementById('font-size-toggle-btn');
    
    // --- HELPERS ---
    const sanitizeHTML = (str) => str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    
    const showLoader = () => {
        resultsContainer.innerHTML = `
          <div class="flex justify-center items-center py-20">
            <div class="w-10 h-10 border-4 border-gray-400 border-t-transparent rounded-full animate-spin"></div>
          </div>`;
    };

    // --- FONT SIZE CONTROL ---
    const applyFontSize = (size) => {
        document.documentElement.style.fontSize = `${size}px`;
        localStorage.setItem(LS_FONT_KEY, size);
    };
    const initFontSizeControl = () => {
        const savedSize = localStorage.getItem(LS_FONT_KEY);
        if (savedSize) applyFontSize(parseInt(savedSize, 10));

        fontSizeToggleBtn.addEventListener('click', () => {
            const currentSize = parseInt(localStorage.getItem(LS_FONT_KEY) || FONT_SIZES[0], 10);
            const currentIndex = FONT_SIZES.indexOf(currentSize) !== -1 ? FONT_SIZES.indexOf(currentSize) : 0;
            const nextIndex = (currentIndex + 1) % FONT_SIZES.length;
            applyFontSize(FONT_SIZES[nextIndex]);
        });
    };

    // --- CATEGORY FETCH LOGIC ---
    const fetchCategory = async () => {
        const params = new URLSearchParams(window.location.search);
        const category = params.get("q");

        if (!category) {
            categoryNameSpan.innerText = "لم يتم تحديد تصنيف";
            resultsContainer.innerHTML = '';
            return;
        }

        const saneCategory = sanitizeHTML(category);
        categoryNameSpan.innerText = saneCategory;
        document.title = `تصنيف: ${saneCategory}`;
        showLoader();

        try {
            const response = await fetch(`${ORDS_API_CATEGORY_BASE_URL}/${encodeURIComponent(category)}`);
            if (!response.ok) throw new Error('Network response was not ok');

            const data = await response.json();
            const hits = data.items;
            
            if (!hits || hits.length === 0) {
                resultsContainer.innerHTML = `<div class="text-center py-10 px-4 border border-gray-200"><p>لا توجد نتائج في هذا التصنيف.</p></div>`;
            } else {
                const resultsHTML = hits.map(h => `
                    <div class="result-item">
                        <a href="./details.html?id=${h.id}">
                            <p>${h.text}</p>
                        </a>
                    </div>
                `).join('');
                resultsContainer.innerHTML = `<div>${resultsHTML}</div>`;
            }
        } catch (err) {
            console.error("Failed to fetch category from ORDS:", err);
            resultsContainer.innerHTML = `<div class="text-center py-10 px-4 border border-gray-200"><p class="text-red-500">حدث خطأ أثناء تحميل البيانات.</p></div>`;
        }
    };

    // --- INITIALIZATION ---
    initFontSizeControl();
    fetchCategory();
});
</script>

</body>
</html>
